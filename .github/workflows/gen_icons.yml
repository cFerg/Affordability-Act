name: Generate Icons from SVG

on:
  workflow_dispatch: {}
  push:
    paths:
      - "assets/favicon.svg"

permissions:
  contents: write

jobs:
  gen-icons:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install render tools
        run: |
          sudo apt-get update
          sudo apt-get install -y inkscape imagemagick

      - name: Ensure assets dir
        run: mkdir -p assets

      - name: Render PNG variants from favicon.svg
        run: |
          inkscape assets/favicon.svg --export-type=png --export-filename=assets/icon-512.png -w 512 -h 512
          inkscape assets/favicon.svg --export-type=png --export-filename=assets/icon-192.png -w 192 -h 192
          inkscape assets/favicon.svg --export-type=png --export-filename=assets/apple-touch-icon.png -w 180 -h 180
          inkscape assets/favicon.svg --export-type=png --export-filename=assets/favicon-48.png -w 48 -h 48
          inkscape assets/favicon.svg --export-type=png --export-filename=assets/favicon-32.png -w 32 -h 32
          inkscape assets/favicon.svg --export-type=png --export-filename=assets/favicon-16.png -w 16 -h 16

      - name: Build multi-size favicon.ico
        run: |
          convert assets/favicon-16.png assets/favicon-32.png assets/favicon-48.png assets/favicon.ico

      - name: Commit updated icons (if changed)
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add assets/icon-512.png assets/icon-192.png assets/apple-touch-icon.png assets/favicon-16.png assets/favicon-32.png assets/favicon-48.png assets/favicon.ico
          git diff --cached --quiet || git commit -m "chore(icons): regenerate raster icons from favicon.svg"
          git push
